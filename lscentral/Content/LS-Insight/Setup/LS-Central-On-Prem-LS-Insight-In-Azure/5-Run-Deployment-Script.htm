<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="_Skins_HTML5___Side_Navigation" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../../../" data-mc-has-content-body="True" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="Retail|[%=System.LinkedTitle%]|[%=System.LinkedTitle%]|[%=System.LinkedTitle%]">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="msapplication-config" content="../../../../Skins/Favicons/browserconfig.xml" />
        <link rel="apple-touch-icon" sizes="180x180" href="../../../../Skins/Favicons/apple-touch-icon.png" />
        <link rel="shortcut icon" href="../../../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="96x96" href="../../../../Skins/Favicons/favicon-96x96.png" />
        <link rel="icon" sizes="32x32" href="../../../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="16x16" href="../../../../Skins/Favicons/favicon-16x16.png" /><title>5 Deploy LS Insight</title>
        <link rel="shortcut icon" href="/Content/Resources/Images/favicon.ico" />
        <link href="../../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" />
        <link href="../../../../Skins/Fluid/Stylesheets/foundation.6.2.3.css" rel="stylesheet" />
        <link href="../../../../Skins/Fluid/Stylesheets/Styles.css" rel="stylesheet" />
        <link href="../../../../Skins/Fluid/Stylesheets/Tablet.css" rel="stylesheet" />
        <link href="../../../../Skins/Fluid/Stylesheets/Mobile.css" rel="stylesheet" />
        <link href="../../../Resources/Stylesheets/LSNav.css" rel="stylesheet" />
        <script src="../../../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../../../Resources/Scripts/require.min.js" defer="defer">
        </script>
        <script src="../../../../Resources/Scripts/require.config.js" defer="defer">
        </script>
        <script src="../../../../Resources/Scripts/foundation.6.2.3_custom.js" defer="defer">
        </script>
        <script src="../../../../Resources/Scripts/plugins.min.js" defer="defer">
        </script>
        <script src="../../../../Resources/Scripts/MadCapAll.js" defer="defer">
        </script>
        <script src="../../../Resources/Javascripts/Scroll-Button.js" defer="defer">
        </script>
    </head>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" role="navigation" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-accordion vertical menu off-canvas-list" data-accordion-menu="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div data-sticky-container="" class="title-bar-container">
                        <nav class="title-bar tab-bar sticky" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="only screen and (max-width: 1279px)" data-mc-ignore="true"><a class="skip-to-content fluid-skip showOnFocus" href="#">Skip To Main Content</a>
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <div class="central-dropdown" style="display:none;" id="#centralSmallScreen"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                        <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                            <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                        </div>
                                    </div>
                                    <button class="menu-icon" aria-label="Show Navigation Panel" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="../../../home.html" title="LS Central Help" alt="Logo"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="3" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                    <div class="central-dropdown" style="display:none;" id="#centralTop"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                        <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                            <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie">
                                                <input class="search-field needs-pie" type="search" aria-label="Search Field" placeholder="Search" />
                                                <div class="search-filter-wrapper"><span class="invisible-label" id="search-filters-label">Filter: </span>
                                                    <div class="search-filter" aria-haspopup="true" aria-controls="sf-content" aria-expanded="false" aria-label="Search Filter" title="All Files" role="button" tabindex="0">
                                                    </div>
                                                    <div class="search-filter-content" id="sf-content">
                                                        <ul>
                                                            <li>
                                                                <button class="mc-dropdown-item" aria-labelledby="search-filters-label filterSelectorLabel-00001"><span id="filterSelectorLabel-00001">All Files</span>
                                                                </button>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search" role="button" tabindex="0"><span class="invisible-label">Submit Search</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                    <div class="central-dropdown" style="display:none;"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                        <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                            <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <div class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <nav class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </nav>
                            <div class="body-container">
                                <div data-mc-content-body="True">
                                    <MadCap:conditionalText data-mc-conditions="Default.GoogleAnalytics">
                                        <script>/* <![CDATA[ */
				(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
				(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
				m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
				})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
			
				ga('create', 'UA-58791693-4', 'auto');
			
				var file = document.location.href; 
				file = file.substring(0, (file.indexOf("#") == -1) ? file.length : file.indexOf("#"));
				file = file.substring(0, (file.indexOf("?") == -1) ? file.length : file.indexOf("?"));
				file = file.substring(file.lastIndexOf("/") + 1, file.length);
 
				if (file === 'Search.htm') 
				{
					var newPath = document.location.pathname + document.location.search + document.location.hash;
					newPath = newPath.replace(/#/, '?');
					newPath = newPath.replace(/search\-/, 'q=');
					ga('set', 'page', newPath);
				
					function locationHashChanged()
					{
						newPath = document.location.pathname + document.location.search + document.location.hash;
						newPath = newPath.replace(/#/, '?');
						newPath = newPath.replace(/search\-/, 'q=');
						ga('set', 'page', newPath);
						ga('send', 'pageview');
					}
				
					if(window.HashChangeEvent)
					{
						window.onhashchange = locationHashChanged;
					}
				}
				ga('send', 'pageview');
			/* ]]> */</script>
                                    </MadCap:conditionalText>
                                    <div class="nocontent">
                                        <div class="MCBreadcrumbsBox_0 breadcrumbs" role="navigation" aria-label="Breadcrumbs" data-mc-breadcrumbs-divider=" &gt; " data-mc-breadcrumbs-count="3" data-mc-toc="True"><span class="MCBreadcrumbsPrefix">You are here: </span>
                                        </div>
                                    </div>
                                    <p>&#160;</p>
                                    <div role="main" id="mc-main-content">
                                        <h1><a name="aanchor13122"></a>
                                            <MadCap:concept term="Retail" />5 Deploy LS Insight</h1>
                                        <p>This step is where the magic happens. The deployment script sets up the Azure resources and pipelines that together  populate and store the LS Insight data warehouse. The script runs in PowerShell and will prompt for all the needed information, create connections and resources in the correct places, and in the end create a summary file with all the information and store it on your server.</p>
                                        <p>The steps below explain some of the steps in details, but the script should be self explanatory. It will verify the data you enter, display summaries for you to confirm along the way, and alert you if something is not right.</p>
                                        <p>The progress of the script is shown at the top for each step. The completed steps are colored green, while the current step is yellow, and the remaining steps are gray.</p>
                                        <h2>Run Deployment script</h2>
                                        <ol>
                                            <li value="1">Navigate to your <i>Base Folder</i>, that is the folder where you downloaded the LS Insight Product package earlier.</li>
                                            <li value="2">In the <i>Base folder</i>, right-click an empty space in the folder and select <b>Open with VS Code</b>.<ul><li value="1">When you open the folder like this you have access to all the files in the folder from VS.</li><li value="2">If you have collected your parameters into a file, you can add that file to the <i>Base folder</i> and you can view it from VS Code as well.</li></ul></li>
                                            <li value="3">If you do not want to use VS Code, you can open the <i> DeploymentScript.ps1</i> using PowerShell ISE, or your favorite PowerShell editor.</li>
                                            <li value="4"> Run the script (F5).<ul><li value="1">The script will check for the Az module setup mentioned earlier, and if the module is missing, the script will terminate and you can set it up at this time by following the steps in step 3 of the wizard.</li><li value="2">The script will check for SqlServer module and install and import if needed.</li><li value="3">If the script detects old LS Insight modules it will remove them and import the modules from the current <i>Base folder</i>.</li></ul></li>
                                        </ol>
                                        <h2>General information</h2>
                                        <p>First, the script will collect some general information about the LS Insight setup.</p>
                                        <ol>
                                            <li value="1">The script prompts for Azure subscription ID:<ul><li value="1">Enter the ID you saved earlier, and click <b>Enter</b>.</li></ul></li>
                                            <li value="2">Next, you will be prompted to enter your Azure account login information.<p><b>Note: </b>The Azure login window will pop up in a different window and might be hidden by VS Code.</p></li>
                                            <li value="3">Then, the script asks you to select the resource group you want to use from a list of resource groups collected from Azure.<ul><li value="1">Enter the number for the resource group you choose, and click <b>Enter</b>.</li></ul></li>
                                            <li value="4">The script will prompt for which type of LS Central you have. Here you should always enter <i>0</i> for On-premises.<ul><li value="1">If you have LS Central in cloud, you should go to the <a href="../LS-Central-In-Cloud-LS-Insight-In-Azure/LS-Central-In-Cloud-LS-Insight-In-Azure.htm">LS Central in Cloud onboarding wizard</a>. The setup for  in cloud is somewhat different from this one.</li></ul></li>
                                        </ol>
                                        <h2>LS Central information</h2>
                                        <p>Next, the script will prompt for <span class="GeneralLSCentral_Mini">LS&#160;Central</span> source database information and credentials:</p>
                                        <ol>
                                            <li value="1">It prompts for the <span class="GeneralLSCentral_Mini">LS&#160;Central</span> source database server name.<ul><li value="1">Enter the name of the server, and click <b>Enter</b>. </li></ul></li>
                                            <li value="2">Next are the credentials for the database user with read privileges that you created in step 1 of the wizard.<ul><li value="1">Enter the user name, click<b> Enter</b>.</li><li value="2">Enter the password, click <b>Enter</b>.</li></ul></li>
                                            <li value="3">Next is the <span class="GeneralLSCentral_Mini">LS&#160;Central</span> source database name.<ul><li value="1">Enter the name of the database, and click <b>Enter</b>. </li></ul></li>
                                            <li value="4">Then the names of all the companies found in the <span class="GeneralLSCentral_Mini">LS&#160;Central</span> database are added to a<i> Companies.txt</i> file that is opened.<ul><li value="1">If you want to exclude some of the companies found in the database from the LS Insight setup, you can delete them from the file at this point.</li></ul><ul><li value="1">Save the file if you edited it.</li><li value="2">Click <b>Enter</b> in the script and the script will prompt for verification of the companies in the file.</li><li value="3">Enter <i>y</i> if they are correct or <i>n</i> if you want to edit the file again.<ul><li value="1">If you select <i>n</i>, edit the file, save, and then click <b>Enter</b> in the script when you are done.</li></ul></li></ul><p style="color: #000000;">If the connection to <span class="GeneralLSCentral_Mini">LS&#160;Central</span> is unsuccessful, the script will allow you to either try entering the connection parameters again, or if you know you cannot connect to <span class="GeneralLSCentral_Mini">LS&#160;Central</span> from the server you are running the script from but you will be able to connect from Azure, you can continue with the parameters you entered without verifying, and you will then need to enter one or more company names into the file. </p><p style="color: #000000;"><b>Note:</b> If you are connecting to an SQL&#160;server with a named instance, for example <i>&lt;computer name&gt;\SQLEXPRESS </i>and you are unable to connect to the <span class="GeneralLSCentral_Mini">LS&#160;Central</span> source, read the guide on <a href="../../Remote-Connection-To-Named-Instance.htm">how to configure SQL server to allow remote connections to named instances</a>.</p><p style="color: #000000;">If you know that you cannot connect to the <span class="GeneralLSCentral_Mini">LS&#160;Central</span> source from the computer where you are running the script, but want to continue anyway:</p><ul><li value="1">Enter the company name(s) exactly as it is displayed in the<b> Companies </b>table in <span class="GeneralLSCentral_Mini">LS&#160;Central</span> into the file, and click <b>Enter</b>.</li></ul></li>
                                            <li value="5">
                                                <p>The script will now display a summary of the <span class="GeneralLSCentral_Mini">LS&#160;Central</span> source database information you have selected and entered. If everything is correct, you can just enter a <i>y</i> and the script will continue, but if you do nothing or enter any other letter, the script will start collecting the <span class="GeneralLSCentral_Mini">LS&#160;Central</span> source information again.</p>
                                            </li>
                                        </ol>
                                        <h2>LS Insight information</h2>
                                        <p>The script now prompts for information relating directly to the setup of LS Insight in Azure.</p>
                                        <ol>
                                            <li value="1">Next you will be asked whether you want to host the LS Insight database, in Azure cloud or on-premises.<ul><li value="1">Here you should always select <i>1 </i>for Cloud.</li><li value="2">If you want to set up LS&#160;Insight database on-premises on an existing SQL server, you should select the <a href="../LS-Central-On-Prem-LS-Insight-On-Prem/LS-Central-On-Prem-LS-Insight-On-Prem.htm">LS Insight on-premises onboarding wizard.</a></li></ul></li>
                                            <li value="2">Next, the script asks whether you want to create a new SQL server in Azure or use an existing one. The number of existing SQL servers in the resource group you selected is displayed in parenthesis behind this option. We recommend setting up a new server, if possible.<ul><li value="1">Enter<i> 0</i>, if you want to create a new server</li><li value="2">Enter <i>1</i>, if you want to use an existing server.</li></ul></li>
                                            <li value="3">If you choose to create a new server, you will next be prompted for a name for the new server. If not, go to step 4 below.<ul><li value="1">Enter a name for the new server, click <b>Enter</b>.</li></ul><p>Then you will be asked to create a new server admin login:</p><ul><li value="1">Enter a user name for the new admin user, click <b>Enter</b>.<ul><li value="1">If the user name does not meet the rules provided in the script you need to choose a new user name.</li></ul></li><li value="2">Enter a password for the new admin user, click <b>Enter</b>.<ul><li value="1">If the password you enter does not meet the rules provided in the script you need to enter the user name again and select a new password.</li></ul></li><li value="3">Confirm the password by entering it again, and click<b> Enter</b>.<ul><li value="1">Make sure you save this password somewhere or select something you will definitely remember since this password is not saved anywhere and you will need to provide it when connecting the Power BI reports to LS Insight later in the process.</li></ul></li></ul><p>You can now move directly to step 6 below, since step 4 only applies if you selected to use an existing Azure SQL server.</p></li>
                                            <li value="4">If you choose to use an existing server, the script will display a list of existing server names  for you to choose from.<ul><li value="1">Enter the number of the server you want to use, and click <b>Enter</b>. </li></ul><p>Then you will be asked to provide the admin login credentials for the server you selected:</p><ul><li value="1">Enter the user name for the admin user of the server you selected, click <b> Enter</b>.</li><li value="2">Enter the password for the admin user of the server you selected, click <b>Enter</b>.</li></ul></li>
                                            <li value="5">Now the script prompts for database name for the new LS&#160;Insight database.<ul><li value="1">Enter a name for the database, click <b>Enter</b>.</li></ul></li>
                                            <li value="6">Then select which Azure pricing tier you want to use for the database.<ul><li value="1">Enter the number for the pricing tier you select. We recommend selecting tier S2. </li><li value="2">You can read more about the pricing tiers on the <a href="../Azure-Cost-Calculations.htm">Azure cost calculation page</a>.</li></ul></li>
                                            <li value="7">Now the script prompts for a name for the Azure data factory that will be created in Azure and contains all the pipelines needed to move data between databases and tables.<ul><li value="1">Enter the name for the Azure Data Factory (ADF), click<b> Enter</b>.</li><li value="2"><b>Note:</b> The ADF name must be globally unique in Azure, so we recommend that if you want to call it <i>LSInsight</i> that you add some additional letters or numbers to the ADF name.</li></ul></li>
                                            <li value="8">Next the script offers to use that same location for your Azure resources that is set on the resource group you selected before and displays that location.<ul><li value="1">This is most likely what you want to do and then you enter <i>y</i> and click <b>Enter</b>.</li></ul><ul><li value="1">If you for some reason want to select a different location then you enter <i>n</i> at this point and click <b>Enter</b>.</li><li value="2">The script will then look up all allowed locations in your subscription which will take a few minutes and then ask you to select the location you want.<ul style="list-style-type: circle;"><li value="1">Enter the number of the location you select and click <b>Enter</b>.</li></ul></li></ul></li>
                                            <li value="9">The script will now display a summary of the LS Insight parameters you have selected and entered. If everything is correct, you can just enter a <i>y</i> and the script will continue, but if you do nothing or enter any other letter, the script will start collecting the LS Insight setup parameters again.</li>
                                        </ol>
                                        <h3>Install LS&#160;Insight</h3>
                                        <ol>
                                            <li value="1">The script will now create the resources in Azure and create the pre-staging tables in the LS Insight database.<p><b>Tip:&#160;</b>This will usually take about 5-10 minutes. Sometimes the import of the SQL database takes longer, caused by load on the Azure service. In that case continue with creating the Azure Data Factory, but you cannot continue the onboarding process until the database resource has been created. How to check this is explained later in the onboarding process.</p><p><b>The script will print out the following lines as the resources are created:</b></p><p>Installing LS Insight...</p><p>Creating a new Azure SQL server. This might take a few minutes... (This will not appear if you selected existing server)</p><p>Adding firewall rules...</p><p>Creating a new Azure SQL database. This might take a while...</p><p>Creating a new Azure Data Factory v2. This might take a while...</p><p>Adding companies into the LS Insight database...</p></li>
                                            <li value="2">
                                                <p>If at any point there is a validation error or something goes wrong, the script will terminate and print out a red error message. This most often explains the issue and the error is also written to the error log in the base folder. Some errors are clear, but others might be more cryptic and then it can be good to check the error log and the <a href="../../Troubleshooting.htm">troubleshooting</a> section of the help.</p>
                                                <p>When you run the script again after an error occurs, the script tries to reuse the parameters you selected before, but asks for verification so you must be careful to answer <i>n</i> if you want to change something.</p>
                                            </li>
                                            <li value="3">Once the script is done, it will:&#160;<ul><li value="1"> Print out the parameters needed to connect the Power BI reports to the LS&#160;Insight database, except from LS Insight admin user password. <ul style="list-style-type: circle;"><li value="1">This saves you the lookup in Azure for the server path. If you want to close VS Code it is a good idea to copy this information and save it somewhere for safe keeping.</li></ul></li><li value="2"> Notify you by printing out a message (Done!).</li><li value="3">Add a new folder (<i>YYYYMMDDHHMM-MyProject</i>)  in the <i>Base Folder</i>.</li><li value="4"> Save the deployment information to the <i>Parameters.json</i> file in the <b>MyProject</b> folder.</li></ul></li>
                                        </ol>
                                        <p>&#160;</p>
                                        <p><a href="4-Download-LS-Insight-Product-Package.htm">&lt; Back</a><a style="float: right;" href="6-Azure-Setup.htm">Next &gt;</a>
                                        </p>
                                        <p>&#160;</p>
                                        <p>&#160;</p>
                                    </div>
                                    <div id="footer" class="ls-nav-footer">
                                        <hr width="100%" size="0" align="center" />
                                        <p>© <span class="VariablesCurrentYear">2021</span> LS Retail ehf. All rights reserved.  </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div><a data-close="true"></a>
                </div>
            </div>
        </div>
    </body>
</html>