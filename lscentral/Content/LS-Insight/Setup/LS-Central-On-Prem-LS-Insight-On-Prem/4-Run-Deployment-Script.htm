<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="_Skins_HTML5___Side_Navigation" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../../../" data-mc-has-content-body="True" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="Retail|[%=System.LinkedTitle%]|[%=System.LinkedTitle%]|[%=System.LinkedTitle%]">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="msapplication-config" content="../../../../Skins/Favicons/browserconfig.xml" />
        <link rel="apple-touch-icon" sizes="180x180" href="../../../../Skins/Favicons/apple-touch-icon.png" />
        <link rel="shortcut icon" href="../../../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="96x96" href="../../../../Skins/Favicons/favicon-96x96.png" />
        <link rel="icon" sizes="32x32" href="../../../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="16x16" href="../../../../Skins/Favicons/favicon-16x16.png" /><title>4 Deploy LS Insight</title>
        <link rel="shortcut icon" href="/Content/Resources/Images/favicon.ico" />
        <link href="../../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" />
        <link href="../../../../Skins/Fluid/Stylesheets/foundation.6.2.3.css" rel="stylesheet" />
        <link href="../../../../Skins/Fluid/Stylesheets/Styles.css" rel="stylesheet" />
        <link href="../../../../Skins/Fluid/Stylesheets/Tablet.css" rel="stylesheet" />
        <link href="../../../../Skins/Fluid/Stylesheets/Mobile.css" rel="stylesheet" />
        <link href="../../../Resources/Stylesheets/LSNav.css" rel="stylesheet" />
        <script src="../../../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../../../Resources/Scripts/require.min.js" defer="defer">
        </script>
        <script src="../../../../Resources/Scripts/require.config.js" defer="defer">
        </script>
        <script src="../../../../Resources/Scripts/foundation.6.2.3_custom.js" defer="defer">
        </script>
        <script src="../../../../Resources/Scripts/plugins.min.js" defer="defer">
        </script>
        <script src="../../../../Resources/Scripts/MadCapAll.js" defer="defer">
        </script>
        <script src="../../../Resources/Javascripts/Scroll-Button.js" defer="defer">
        </script>
    </head>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" role="navigation" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-accordion vertical menu off-canvas-list" data-accordion-menu="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div data-sticky-container="" class="title-bar-container">
                        <nav class="title-bar tab-bar sticky" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="only screen and (max-width: 1279px)" data-mc-ignore="true"><a class="skip-to-content fluid-skip showOnFocus" href="#">Skip To Main Content</a>
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <div class="central-dropdown" style="display:none;" id="#centralSmallScreen"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                        <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                            <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                        </div>
                                    </div>
                                    <button class="menu-icon" aria-label="Show Navigation Panel" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="../../../home.html" title="LS Central Help" alt="Logo"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="3" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                    <div class="central-dropdown" style="display:none;" id="#centralTop"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                        <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                            <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie">
                                                <input class="search-field needs-pie" type="search" aria-label="Search Field" placeholder="Search" />
                                                <div class="search-filter-wrapper"><span class="invisible-label" id="search-filters-label">Filter: </span>
                                                    <div class="search-filter" aria-haspopup="true" aria-controls="sf-content" aria-expanded="false" aria-label="Search Filter" title="All Files" role="button" tabindex="0">
                                                    </div>
                                                    <div class="search-filter-content" id="sf-content">
                                                        <ul>
                                                            <li>
                                                                <button class="mc-dropdown-item" aria-labelledby="search-filters-label filterSelectorLabel-00001"><span id="filterSelectorLabel-00001">All Files</span>
                                                                </button>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search" role="button" tabindex="0"><span class="invisible-label">Submit Search</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                    <div class="central-dropdown" style="display:none;"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                        <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                            <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <div class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <nav class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </nav>
                            <div class="body-container">
                                <div data-mc-content-body="True">
                                    <MadCap:conditionalText data-mc-conditions="Default.GoogleAnalytics">
                                        <script>/* <![CDATA[ */
				(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
				(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
				m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
				})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
			
				ga('create', 'UA-58791693-4', 'auto');
			
				var file = document.location.href; 
				file = file.substring(0, (file.indexOf("#") == -1) ? file.length : file.indexOf("#"));
				file = file.substring(0, (file.indexOf("?") == -1) ? file.length : file.indexOf("?"));
				file = file.substring(file.lastIndexOf("/") + 1, file.length);
 
				if (file === 'Search.htm') 
				{
					var newPath = document.location.pathname + document.location.search + document.location.hash;
					newPath = newPath.replace(/#/, '?');
					newPath = newPath.replace(/search\-/, 'q=');
					ga('set', 'page', newPath);
				
					function locationHashChanged()
					{
						newPath = document.location.pathname + document.location.search + document.location.hash;
						newPath = newPath.replace(/#/, '?');
						newPath = newPath.replace(/search\-/, 'q=');
						ga('set', 'page', newPath);
						ga('send', 'pageview');
					}
				
					if(window.HashChangeEvent)
					{
						window.onhashchange = locationHashChanged;
					}
				}
				ga('send', 'pageview');
			/* ]]> */</script>
                                    </MadCap:conditionalText>
                                    <div class="nocontent">
                                        <div class="MCBreadcrumbsBox_0 breadcrumbs" role="navigation" aria-label="Breadcrumbs" data-mc-breadcrumbs-divider=" &gt; " data-mc-breadcrumbs-count="3" data-mc-toc="True"><span class="MCBreadcrumbsPrefix">You are here: </span>
                                        </div>
                                    </div>
                                    <p>&#160;</p>
                                    <div role="main" id="mc-main-content">
                                        <h1><a name="aanchor9002"></a>
                                            <MadCap:concept term="Retail" />4 Deploy LS Insight</h1>
                                        <p>This step is where the magic happens. The deployment script sets up the Azure resources and pipelines that together  populate and store the LS Insight data warehouse. The script runs in PowerShell and will prompt for all the needed information, create connections and resources in the correct places, and in the end create a summary file with all the information and store it on your server.</p>
                                        <p>The steps below explain some of the steps in details, but the script should be self explanatory. It will verify the data you enter, display summaries for you to confirm along the way, and alert you if something is not right.</p>
                                        <p>The progress of the script is shown at the top for each step. The completed steps are colored green, while the current step is yellow, and the remaining steps are gray.</p>
                                        <h2>Run Deployment script</h2>
                                        <ol>
                                            <li value="1">Navigate to your <i>Base Folder</i>, that is the folder where you downloaded the LS Insight Product package earlier.</li>
                                            <li value="2">In the <i>Base folder</i>, right-click an empty space in the folder and select <b>Open with VS Code</b>.<ul><li value="1">When you open the folder like this you have access to all the files in the folder from VS.</li><li value="2">If you have collected your parameters into a file, you can add that file to the <i>Base folder</i> and you can view it from VS Code as well.</li></ul></li>
                                            <li value="3">If you do not want to use VS Code, you can open the <i> DeploymentScript.ps1</i> using PowerShell ISE, or your favorite PowerShell editor.</li>
                                            <li value="4"> Run the script (F5).<ul><li value="1">The script will check for the Az module setup mentioned earlier, and if the module is missing, the script will terminate and you can set it up at this time by following the steps in step 3 of the wizard.</li><li value="2">The script will check for SqlServer module and install and import if needed.</li><li value="3">If the script detects old LS Insight modules it will remove them and import the modules from the current <i>Base folder</i>.</li></ul></li>
                                        </ol>
                                        <h2>General information</h2>
                                        <p>First, the script will collect some general information about the LS Insight setup.</p>
                                        <ol>
                                            <li value="1">The script prompts for Azure subscription ID:<ul><li value="1">Enter the ID you saved earlier, and click <b>Enter</b>.</li></ul></li>
                                            <li value="2">Next, you will be prompted to enter your Azure account login information.<p><b>Note: </b>The Azure login window will pop up in a different window and might be hidden by VS Code.</p></li>
                                            <li value="3">Then, the script asks you to select the resource group you want to use from a list of resource groups collected from Azure.<ul><li value="1">Enter the number for the resource group you choose, and click <b>Enter</b>.</li></ul></li>
                                            <li value="4">The script will prompt for which type of LS Central you have. Here you should always enter <i>0</i> for On-premises.<ul><li value="1">If you have LS Central in cloud, you should go to the <a href="../LS-Central-In-Cloud-LS-Insight-In-Azure/LS-Central-In-Cloud-LS-Insight-In-Azure.htm">LS Central in Cloud onboarding wizard</a>. The setup for  in cloud is somewhat different from this one.</li></ul></li>
                                        </ol>
                                        <h2>LS Central information</h2>
                                        <p>Next, the script will prompt for <span class="GeneralLSCentral_Mini">LS&#160;Central</span> source database information and credentials:</p>
                                        <ol>
                                            <li value="1">It prompts for the <span class="GeneralLSCentral_Mini">LS&#160;Central</span> source database server name.<ul><li value="1">Enter the name of the server, and click <b>Enter</b>. </li></ul></li>
                                            <li value="2">Next are the credentials for the database user with read privileges that you created in step 1 of the wizard.<ul><li value="1">Enter the user name, click<b> Enter</b>.</li><li value="2">Enter the password, click <b>Enter</b>.</li></ul></li>
                                            <li value="3">Next is the <span class="GeneralLSCentral_Mini">LS&#160;Central</span> source database name.<ul><li value="1">Enter the name of the database, and click <b>Enter</b>. </li></ul></li>
                                            <li value="4">Then the names of all the companies found in the <span class="GeneralLSCentral_Mini">LS&#160;Central</span> database are added to a<i> Companies.txt</i> file that is opened.<ul><li value="1">If you want to exclude some of the companies found in the database from the LS Insight setup, you can delete them from the file at this point.</li></ul><ul><li value="1">Save the file if you edited it.</li><li value="2">Click <b>Enter</b> in the script and the script will prompt for verification of the companies in the file.</li><li value="3">Enter <i>y</i> if they are correct or <i>n</i> if you want to edit the file again.<ul><li value="1">If you select <i>n</i>, edit the file, save, and then click <b>Enter</b> in the script when you are done.</li></ul></li></ul><p style="color: #000000;">If the connection to <span class="GeneralLSCentral_Mini">LS&#160;Central</span> is unsuccessful, the script will allow you to either try entering the connection parameters again, or if you know you cannot connect to <span class="GeneralLSCentral_Mini">LS&#160;Central</span> from the server you are running the script from but you will be able to connect from Azure, you can continue with the parameters you entered without verifying, and you will then need to enter one or more company names into the file. </p><p style="color: #000000;"><b>Note:</b> If you are connecting to an SQL&#160;server with a named instance, for example <i>&lt;computer name&gt;\SQLEXPRESS </i>and you are unable to connect to the <span class="GeneralLSCentral_Mini">LS&#160;Central</span> source, read the guide on <a href="../../Remote-Connection-To-Named-Instance.htm">how to configure SQL server to allow remote connections to named instances</a>.</p><p style="color: #000000;">If you know that you cannot connect to the <span class="GeneralLSCentral_Mini">LS&#160;Central</span> source from the computer where you are running the script, but want to continue anyway:</p><ul><li value="1">Enter the company name(s) exactly as it is displayed in the<b> Companies </b>table in <span class="GeneralLSCentral_Mini">LS&#160;Central</span> into the file, and click <b>Enter</b>.</li></ul></li>
                                            <li value="5">
                                                <p>The script will now display a summary of the <span class="GeneralLSCentral_Mini">LS&#160;Central</span> source database information you have selected and entered. If everything is correct, you can just enter a <i>y</i> and the script will continue, but if you do nothing or enter any other letter, the script will start collecting the <span class="GeneralLSCentral_Mini">LS&#160;Central</span> source information again.</p>
                                            </li>
                                        </ol>
                                        <h2>LS Insight information</h2>
                                        <p>The script now prompts for information relating directly to the setup of LS Insight in Azure.</p>
                                        <ol>
                                            <li value="1">First, you will be asked whether you want to set up the LS Insight database in  On-premises or in cloud (Azure):<ul><li value="1">Here you should always select <i>0 </i>for your own on-premises SQL&#160;server.</li><li value="2">If you want to set up LS&#160;Insight database in Azure, you should select the <a href="../LS-Central-On-Prem-LS-Insight-In-Azure/LS-Central-On-Prem-LS-Insight-In-Azure.htm">LS Insight in Azure onboarding wizard.</a> If you select to set up in Azure you will also be able to use an existing Azure SQL server.</li></ul></li>
                                            <li value="2">Next, the script displays information about setup of the LS Insight database template on the on-premises SQL server. Follow the instructions in the script to:<ul><li value="1">Restore the database using 'Import Data-tier Application' in SQL&#160;Server Management Studio.</li><li value="2">When you restore the database, select a descriptive name for the database, for example <i>LSInsight</i>.</li><li value="3">Create a SQL&#160;login on the server with read and write privileges to the LS Insight database as well as execute privileges on the stored procedure.<ul style="list-style-type: circle;"><li value="1">Under database - Programmability - Stored Procedures</li><li value="2">Right click dbo.LSInsight$InsertCompany</li><li value="3">Select <b>Properties</b></li><li value="4">Under Permissions tab, search for the sql login you created and click <b>OK</b></li><li value="5">In the lower panel <b>Grant</b> column, check <b>Execute</b> and click <b>OK</b></li></ul></li></ul>When this is done you need to return to the script:<ul><li value="1">Enter <i>y</i> in the script to continue.</li></ul></li>
                                            <li value="3">You will next be prompted for the name of the on-premises SQL server: <ul><li value="1">Enter the name of the SQL server, click <b>Enter</b>.</li></ul></li>
                                            <li value="4">You will then be prompted for the name of the LS Insight database:<ul><li value="1">Enter the name of the database, click <b>Enter</b>.</li></ul></li>
                                            <li value="5">Then you will be asked to provide the login credentials you just created for the database:<ul><li value="1">Enter the user name of the SQL login, click <b>Enter</b>.</li><li value="2">Enter the password of the SQL login, click<b> Enter</b>.</li></ul></li>
                                            <li value="6">Now the script prompts for a name for the Azure Data Factory that will be created in Azure and contains all the pipelines needed to move data between database and tables.<ul><li value="1">Enter the name for the Azure Data Factory (ADF), click <b>Enter</b>.</li><li value="2"><b>Note:</b> The ADF name must be globally unique in Azure, so we recommend that if you want to call it <i>LSInsight</i> that you add some additional letters or numbers to the ADF name.</li></ul></li>
                                            <li value="7">Next the script offers to use that same location for your Azure resources that is set on the resource group you selected before and displays that location.<ul><li value="1">This is most likely what you want to do and then you enter <i>y</i> and click <b>Enter</b>.</li></ul><ul><li value="1">If you for some reason want to select a different location then you enter <i>n</i> at this point and click <b>Enter</b>.</li><li value="2">The script will then look up all allowed locations in your subscription which will take a few minutes and then ask you to select the location you want.<ul style="list-style-type: circle;"><li value="1">Enter the number of the location you select and click <b>Enter</b>.</li></ul></li></ul></li>
                                            <li value="8">The script will now display a summary of the LS Insight parameters you have selected and entered. If everything is correct, you can just enter a <i>y</i> and the script will continue, but if you do nothing or enter any other letter, the script will start collecting the LS Insight setup parameters again.</li>
                                        </ol>
                                        <h2>Install LS&#160;Insight</h2>
                                        <ol>
                                            <li value="1">The script will now create the Azure Data Factory in Azure.<p><b>Tip:&#160;</b>This will take about 1 minute</p><p><b>The script will print out the following lines as the resources are created:</b></p><p>Installing LS Insight...</p><p>Creating a new Azure Data Factory v2. This might take a while...</p><p>Adding companies into the LS Insight database...</p></li>
                                            <li value="2">
                                                <p>If at any point there is a validation error or something goes wrong, the script will terminate and print out a red error message. This most often explains the issue and the error is also written to the error log in the base folder. Some errors are clear, but others might be more cryptic and then it can be good to check the error log and the <a href="../../Troubleshooting.htm">troubleshooting</a> section of the help.</p>
                                                <p>When you run the script again after an error occurs, the script tries to reuse the parameters you selected before but asks for verification, so you must be careful to answer <i>n</i> if you want to change something.</p>
                                            </li>
                                            <li value="3">Once the script is done, it will:<ul><li value="1">  Print out the parameters needed to connect the Power BI reports to the LS&#160;Insight database, except from LS Insight user password. <ul style="list-style-type: circle;"><li value="1"> If you want to close VS Code it is a good idea to copy this information and save it somewhere for safe keeping.</li></ul></li><li value="2">Notify you by printing out a message (Done!).</li><li value="3">Add a new folder (<i>YYYYMMDDHHMM-MyProject</i>)  in the <i>Base Folder</i>.</li><li value="4"> Save the deployment information to the <i>Parameters.json</i> file in the MyProject folder.</li></ul></li>
                                        </ol>
                                        <p><b>Note:</b> If the LS Insight SQL server is a named instance and contains a \ (backslash), it will be displayed as a double \\ (backslash) in <i>Parameters.json</i>. Change this to a single \ (backslash) so this is correct when it is used to connect the reports to the LS Insight database</p>
                                        <p>
                                            <p><a href="3-Machine-Or-VM.htm">&lt; Back</a>
                                            </p><a style="float: right;" href="5-Azure-Setup.htm">Next &gt;</a>
                                        </p>
                                        <p>&#160;</p>
                                        <p>&#160;</p>
                                    </div>
                                    <div id="footer" class="ls-nav-footer">
                                        <hr width="100%" size="0" align="center" />
                                        <p>© <span class="VariablesCurrentYear">2021</span> LS Retail ehf. All rights reserved.  </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div><a data-close="true"></a>
                </div>
            </div>
        </div>
    </body>
</html>