<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="_Skins_HTML5___Side_Navigation" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../../../../" data-mc-has-content-body="True" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="Retail|LS&#160;eCommerce|[%=System.LinkedTitle%]|Code Samples">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="msapplication-config" content="../../../../../Skins/Favicons/browserconfig.xml" />
        <link rel="apple-touch-icon" sizes="180x180" href="../../../../../Skins/Favicons/apple-touch-icon.png" />
        <link rel="shortcut icon" href="../../../../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="96x96" href="../../../../../Skins/Favicons/favicon-96x96.png" />
        <link rel="icon" sizes="32x32" href="../../../../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="16x16" href="../../../../../Skins/Favicons/favicon-16x16.png" /><title>Add New Function to LS&#160;Commerce Service</title>
        <link rel="shortcut icon" href="/Content/Resources/Images/favicon.ico" />
        <link href="../../../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" />
        <link href="../../../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" />
        <link href="../../../../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" />
        <link href="../../../../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" />
        <link href="../../../../../Skins/Fluid/Stylesheets/foundation.6.2.3.css" rel="stylesheet" />
        <link href="../../../../../Skins/Fluid/Stylesheets/Styles.css" rel="stylesheet" />
        <link href="../../../../../Skins/Fluid/Stylesheets/Tablet.css" rel="stylesheet" />
        <link href="../../../../../Skins/Fluid/Stylesheets/Mobile.css" rel="stylesheet" />
        <link href="../../../../Resources/Stylesheets/LSNav.css" rel="stylesheet" />
        <script src="../../../../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../../../../Resources/Scripts/require.min.js" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/require.config.js" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/foundation.6.2.3_custom.js" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/plugins.min.js" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/MadCapAll.js" defer="defer">
        </script>
        <script src="../../../../Resources/Javascripts/Scroll-Button.js" defer="defer">
        </script>
    </head>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" role="navigation" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-accordion vertical menu off-canvas-list" data-accordion-menu="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div data-sticky-container="" class="title-bar-container">
                        <nav class="title-bar tab-bar sticky" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="only screen and (max-width: 1279px)" data-mc-ignore="true"><a class="skip-to-content fluid-skip showOnFocus" href="#">Skip To Main Content</a>
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <div class="central-dropdown" style="display:none;" id="#centralSmallScreen"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                        <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                            <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                        </div>
                                    </div>
                                    <button class="menu-icon" aria-label="Show Navigation Panel" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="../../../../home.html" title="LS Central Help" alt="Logo"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="3" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                    <div class="central-dropdown" style="display:none;" id="#centralTop"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                        <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                            <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie">
                                                <input class="search-field needs-pie" type="search" aria-label="Search Field" placeholder="Search" />
                                                <div class="search-filter-wrapper"><span class="invisible-label" id="search-filters-label">Filter: </span>
                                                    <div class="search-filter" aria-haspopup="true" aria-controls="sf-content" aria-expanded="false" aria-label="Search Filter" title="All Files" role="button" tabindex="0">
                                                    </div>
                                                    <div class="search-filter-content" id="sf-content">
                                                        <ul>
                                                            <li>
                                                                <button class="mc-dropdown-item" aria-labelledby="search-filters-label filterSelectorLabel-00001"><span id="filterSelectorLabel-00001">All Files</span>
                                                                </button>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search" role="button" tabindex="0"><span class="invisible-label">Submit Search</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                    <div class="central-dropdown" style="display:none;"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                        <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                            <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <div class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <nav class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </nav>
                            <div class="body-container">
                                <div data-mc-content-body="True">
                                    <MadCap:conditionalText data-mc-conditions="Default.GoogleAnalytics">
                                        <script>/* <![CDATA[ */
				(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
				(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
				m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
				})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
			
				ga('create', 'UA-58791693-4', 'auto');
			
				var file = document.location.href; 
				file = file.substring(0, (file.indexOf("#") == -1) ? file.length : file.indexOf("#"));
				file = file.substring(0, (file.indexOf("?") == -1) ? file.length : file.indexOf("?"));
				file = file.substring(file.lastIndexOf("/") + 1, file.length);
 
				if (file === 'Search.htm') 
				{
					var newPath = document.location.pathname + document.location.search + document.location.hash;
					newPath = newPath.replace(/#/, '?');
					newPath = newPath.replace(/search\-/, 'q=');
					ga('set', 'page', newPath);
				
					function locationHashChanged()
					{
						newPath = document.location.pathname + document.location.search + document.location.hash;
						newPath = newPath.replace(/#/, '?');
						newPath = newPath.replace(/search\-/, 'q=');
						ga('set', 'page', newPath);
						ga('send', 'pageview');
					}
				
					if(window.HashChangeEvent)
					{
						window.onhashchange = locationHashChanged;
					}
				}
				ga('send', 'pageview');
			/* ]]> */</script>
                                    </MadCap:conditionalText>
                                    <div class="nocontent">
                                        <div class="MCBreadcrumbsBox_0 breadcrumbs" role="navigation" aria-label="Breadcrumbs" data-mc-breadcrumbs-divider=" &gt; " data-mc-breadcrumbs-count="3" data-mc-toc="True"><span class="MCBreadcrumbsPrefix">You are here: </span>
                                        </div>
                                    </div>
                                    <p>&#160;</p>
                                    <div role="main" id="mc-main-content">
                                        <h1><a name="aanchor1218"></a>
                                            <MadCap:concept term="Retail" />Add New Function to <span class="GeneralLSCommerce">LS&#160;Commerce</span> Service</h1>
                                        <p>This sample describes how to add a new function to <span class="GeneralLSCommerce">LS&#160;Commerce</span> Service API Interface that can be called from a Mobile Loyalty App or from the eCommerce Web Site.</p>
                                        <p class="shortcut"><a href="#Sample" class="MCXref xref">Sample MyCustomFunction</a>
                                        </p>
                                        <p>Open Source code for <span class="GeneralLSCommerce">LS&#160;Commerce</span> Service and Mobile Apps is stored in separate Git repositories.</p>
                                        <p>The code can be joined together, if you are working with the Loyalty App, as the code in the<b> Common</b> folder is same in both solutions. For eCommerce, Loyalty App code is not needed.</p>
                                        <ol>
                                            <li value="1">Open <b>Server\WcfService\LSOmniService.sln</b> <br />(in some cases, you need to run Visual Studio as Admin to load Service Project)</li>
                                            <li value="2">Set <b>Service</b> Project as StartUp Project.</li>
                                            <li value="3">Set correct connection data into Service\AppSettings.config</li>
                                            <li value="4">Set which DataAccess Project <span class="GeneralLSCommerce">LS&#160;Commerce</span> Service should run<p>&lt;add key="BOConnection.AssemblyName" value="LSOmni.DataAccess.BOConnection.CentralPre.dll"/&gt;</p></li>
                                        </ol>
                                        <p><b>Tip:&#160;</b>You can get this data from an already installed and running <span class="GeneralLSCommerce">LS&#160;Commerce</span> Service.</p>
                                        <p><b><span class="GeneralLSCommerce">LS&#160;Commerce</span> Service uses these interfaces:</b>
                                        </p>
                                        <table>
                                            <col />
                                            <col />
                                            <col />
                                            <tbody>
                                                <tr>
                                                    <td style="font-weight: bold;">Json Interface</td>
                                                    <td style="font-weight: bold;">SOAP Interface</td>
                                                    <td style="font-weight: bold;">Usage</td>
                                                </tr>
                                                <tr>
                                                    <td>IBOJson</td>
                                                    <td>IBOService</td>
                                                    <td><span class="GeneralLSCentral_Mini">LS&#160;Central</span> to communicate back to <span class="GeneralLSCommerce">LS&#160;Commerce</span> Service</td>
                                                </tr>
                                                <tr>
                                                    <td>IUCJson</td>
                                                    <td>IUCService</td>
                                                    <td>Ecommerce and Loyalty API Interface</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                        <p><b>The main code blocks are:</b>
                                        </p>
                                        <table>
                                            <col />
                                            <col />
                                            <tr>
                                                <td>Commons\Domain.DataModel.Base</td>
                                                <td>Common Data objects used by all apps and Web sites and common code used by the Common Data Object.</td>
                                            </tr>
                                            <tr>
                                                <td>Commons\Domain.DataModel.Loyalty</td>
                                                <td>Common Loyalty Data objects.</td>
                                            </tr>
                                            <tr>
                                                <td>DataAccess\BOConnection.PreCommon</td>
                                                <td>Web service communication against <span class="GeneralLSCentral_Mini">LS&#160;Central</span> 17.5 and later.</td>
                                            </tr>
                                            <tr>
                                                <td>DataAccess\BOConnection.NavCommon</td>
                                                <td>Web service communication against<span class="GeneralLSCentral_Mini">LS&#160;Central</span> 17.4 or older LS Nav.</td>
                                            </tr>
                                            <tr>
                                                <td>DataAccess\BOConnection.CentralPre</td>
                                                <td>Data communication for <span class="GeneralLSCentral_Mini">LS&#160;Central</span> 17.5 and later.</td>
                                            </tr>
                                            <tr>
                                                <td>DataAccess\BOConnection.CentrAL</td>
                                                <td>Data communication for <span class="GeneralLSCentral_Mini">LS&#160;Central</span> 15 to 17.4.</td>
                                            </tr>
                                            <tr>
                                                <td>DataAccess\BOConnection.NavSQL</td>
                                                <td>Data communication for <span class="GeneralLSCentral_Mini">LS&#160;Central</span> 14 and older LS Nav.</td>
                                            </tr>
                                            <tr>
                                                <td>DataAccess\BOConnection.NavWS</td>
                                                <td>Web Data communication for <span class="GeneralLSCentral_Mini">LS&#160;Central</span> in the cloud.</td>
                                            </tr>
                                            <tr>
                                                <td>DataAccess\Data.SQLServer</td>
                                                <td>Local <span class="GeneralLSCommerce">LS&#160;Commerce</span> SQL Database communication.</td>
                                            </tr>
                                            <tr>
                                                <td>DataAccess\Interfaces</td>
                                                <td>Interface files for DataAccess projects.</td>
                                            </tr>
                                            <tr>
                                                <td>BusinessLayer</td>
                                                <td>Business Logic that takes care of loading correct DataAccess code and calls the function.</td>
                                            </tr>
                                            <tr>
                                                <td>Service</td>
                                                <td><span class="GeneralLSCommerce">LS&#160;Commerce</span> Service Interface code.</td>
                                            </tr>
                                        </table>
                                        <p><b>Tip:&#160;</b>You can remove DataAccess projects that <span class="GeneralLSCommerce">LS&#160;Commerce</span> Service will not be using to make things easier while coding.</p>
                                        <p><span class="GeneralLSCentral_Mini">LS&#160;Central</span> 14 or older LS Nav, running on-premises: you can remove projects CentralPre, CentrAL and NavWS.</p>
                                        <p><span class="GeneralLSCentral_Mini">LS&#160;Central</span> 17.5 and later running on-premises:&#160;you can remove projects NavSQL, CentrAL and NavWS.</p>
                                        <h3><a name="Sample"></a>Sample MyCustomFunction</h3>
                                        <p>The most common code path is the following: </p>
                                        <p><span class="GeneralLSCommerce">LS&#160;Commerce</span> Service Interface calls the Business Layer, which loads the DataAccess code according to settings in the <i>AppSettings.config </i>file, and then calls the code in appropriated DataAcccess that gets the data from its source, either direct from database or web service.</p>
                                        <p>In the Bitbucket code, there is already a sample of a new function, <i>MyCustomFunction</i>, which Web Sites and the Loyalty app can both use. <br /><b>Tip:&#160;</b>It is best to start from the end of the code path when adding a new function.</p>
                                        <p>Depending on the <span class="GeneralLSCentral_Mini">LS&#160;Central</span> version, your code should be placed in the appropriated DataAccess Project, see table above for which project to use. You can also remove the other projects that you will not be using.</p>
                                        <p>The sample has code for <span class="GeneralLSCentral_Mini">LS&#160;Central</span> 14, 15, and 18.</p>
                                        <p><b>NavSQL</b> project is used for <span class="GeneralLSCentral_Mini">LS&#160;Central</span> 14 and earlier versions of LS Nav.</p>
                                        <p>The main on-premises database processing code is located in the <b>Dal </b>folder.</p>
                                        <p>
                                            <img src="../../../../Resources/Images/LS Omni/Unified Commerce Interface/Code1_700x578.png" style="width: 700;height: 578;" />
                                        </p>
                                        <p>The code that takes care of deciding if it should call web service or go directly into BC Database is <i>NavCustom.cs</i>.</p>
                                        <p>This sample shows how to make a direct Database call and how to use <span class="GeneralLSCentral_Mini">LS&#160;Central</span> Web Service call, but you would only use one of the methods.</p>
                                        <p>
                                            <img src="../../../../Resources/Images/LS Omni/Unified Commerce Interface/Code2_600x473.png" style="width: 600;height: 473;" />
                                        </p>
                                        <p>The same applies to <span class="GeneralLSCentral_Mini">LS&#160;Central</span> 15 to 17.4:&#160;you do the same as above, except it is done in <b>CentrAL</b> project (<i>DataAccess\BOConnection.CentrAL</i>). </p>
                                        <p>For <span class="GeneralLSCentral_Mini">LS&#160;Central</span> 17.5 and later, do the code in <b>CentralPre</b> project (<i>DataAccess\BOConnection.CentralPre</i>)</p>
                                        <p>Interface for all DataAccess projects is added here:</p>
                                        <p>
                                            <img src="../../../../Resources/Images/LS Omni/Unified Commerce Interface/Code4.png" />
                                        </p>
                                        <p>Business Layer loads up the DataAccess DLL according to app settings and then calls the new function:</p>
                                        <p>
                                            <img src="../../../../Resources/Images/LS Omni/Unified Commerce Interface/Code5.png" />
                                        </p>
                                        <p><span class="GeneralLSCommerce">LS&#160;Commerce</span> Public Interfaces call this code, which then calls the function in Business Layer. This is where the code flows begins when incoming calls come in. <br /><b>Tip:&#160;</b>You can put your break point here to catch the beginning of the code flow when doing debug.</p>
                                        <p>
                                            <img src="../../../../Resources/Images/LS Omni/Unified Commerce Interface/Code6.png" />
                                        </p>
                                        <p>Public interfaces</p>
                                        <p>
                                            <img src="../../../../Resources/Images/LS Omni/Unified Commerce Interface/Code7.png" />
                                        </p>
                                        <p>Testing MyCustomFunction</p>
                                        <ul>
                                            <li value="1">
                                                <p>Run the solution, and Internet Explorer will start up and wait like this:</p>
                                                <p>
                                                    <img src="../../../../Resources/Images/LS Omni/Unified Commerce Interface/How to add new function to.png" class="images" />
                                                </p>
                                            </li>
                                            <li value="2">
                                                <p>To test if the connection is working, type this in a browser:</p>
                                                <p><a href="http://localhost/LSCommerceService/ucjson.svc/Ping">http://localhost/LSCommerceService/ucjson.svc/Ping</a>
                                                </p>
                                            </li>
                                        </ul>
                                        <p>If all is in order, you get this answer:</p>
                                        <p>
                                            <img src="../../../../Resources/Images/LS Omni/Unified Commerce Interface/How to add new function to_1_800x64.png" style="width: 800;height: 64;" />
                                        </p>
                                        <p><b>Tip:&#160;</b>SoapUI is a free tool that can be used to test the SOAP (service) interface. There you can find your new function and put in some data, run it, and get the result:</p>
                                        <p>
                                            <img src="../../../../Resources/Images/LS Omni/Unified Commerce Interface/How to add new function to_2_700x194.png" class="images" style="width: 700;height: 194;" />
                                        </p>
                                        <p>&#160;</p>
                                        <p>&#160;</p>
                                    </div>
                                    <div id="footer" class="ls-nav-footer">
                                        <hr width="100%" size="0" align="center" />
                                        <p>© <span class="VariablesCurrentYear">2021</span> LS Retail ehf. All rights reserved.  </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div><a data-close="true"></a>
                </div>
            </div>
        </div>
    </body>
</html>