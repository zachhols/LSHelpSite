<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="_Skins_HTML5___Side_Navigation" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../../../" data-mc-has-content-body="True" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="Retail|LS Data Director|How to ... ">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="msapplication-config" content="../../../../Skins/Favicons/browserconfig.xml" />
        <link rel="apple-touch-icon" sizes="180x180" href="../../../../Skins/Favicons/apple-touch-icon.png" />
        <link rel="shortcut icon" href="../../../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="96x96" href="../../../../Skins/Favicons/favicon-96x96.png" />
        <link rel="icon" sizes="32x32" href="../../../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="16x16" href="../../../../Skins/Favicons/favicon-16x16.png" /><title>How to:&#160;Run SQL Store Procedures</title>
        <link rel="shortcut icon" href="/Content/Resources/Images/favicon.ico" />
        <link href="../../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" />
        <link href="../../../../Skins/Fluid/Stylesheets/foundation.6.2.3.css" rel="stylesheet" />
        <link href="../../../../Skins/Fluid/Stylesheets/Styles.css" rel="stylesheet" />
        <link href="../../../../Skins/Fluid/Stylesheets/Tablet.css" rel="stylesheet" />
        <link href="../../../../Skins/Fluid/Stylesheets/Mobile.css" rel="stylesheet" />
        <link href="../../../Resources/Stylesheets/LSNav.css" rel="stylesheet" />
        <script src="../../../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../../../Resources/Scripts/require.min.js" defer="defer">
        </script>
        <script src="../../../../Resources/Scripts/require.config.js" defer="defer">
        </script>
        <script src="../../../../Resources/Scripts/foundation.6.2.3_custom.js" defer="defer">
        </script>
        <script src="../../../../Resources/Scripts/plugins.min.js" defer="defer">
        </script>
        <script src="../../../../Resources/Scripts/MadCapAll.js" defer="defer">
        </script>
        <script src="../../../Resources/Javascripts/Scroll-Button.js" defer="defer">
        </script>
    </head>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" role="navigation" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-accordion vertical menu off-canvas-list" data-accordion-menu="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div data-sticky-container="" class="title-bar-container">
                        <nav class="title-bar tab-bar sticky" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="only screen and (max-width: 1279px)" data-mc-ignore="true"><a class="skip-to-content fluid-skip showOnFocus" href="#">Skip To Main Content</a>
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <div class="central-dropdown" style="display:none;" id="#centralSmallScreen"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                        <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                            <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                        </div>
                                    </div>
                                    <button class="menu-icon" aria-label="Show Navigation Panel" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="../../../home.html" title="LS Central Help" alt="Logo"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="3" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                    <div class="central-dropdown" style="display:none;" id="#centralTop"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                        <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                            <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie">
                                                <input class="search-field needs-pie" type="search" aria-label="Search Field" placeholder="Search" />
                                                <div class="search-filter-wrapper"><span class="invisible-label" id="search-filters-label">Filter: </span>
                                                    <div class="search-filter" aria-haspopup="true" aria-controls="sf-content" aria-expanded="false" aria-label="Search Filter" title="All Files" role="button" tabindex="0">
                                                    </div>
                                                    <div class="search-filter-content" id="sf-content">
                                                        <ul>
                                                            <li>
                                                                <button class="mc-dropdown-item" aria-labelledby="search-filters-label filterSelectorLabel-00001"><span id="filterSelectorLabel-00001">All Files</span>
                                                                </button>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search" role="button" tabindex="0"><span class="invisible-label">Submit Search</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                    <div class="central-dropdown" style="display:none;"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                        <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                            <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <div class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <nav class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </nav>
                            <div class="body-container">
                                <div data-mc-content-body="True">
                                    <MadCap:conditionalText data-mc-conditions="Default.GoogleAnalytics">
                                        <script>/* <![CDATA[ */
				(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
				(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
				m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
				})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
			
				ga('create', 'UA-58791693-4', 'auto');
			
				var file = document.location.href; 
				file = file.substring(0, (file.indexOf("#") == -1) ? file.length : file.indexOf("#"));
				file = file.substring(0, (file.indexOf("?") == -1) ? file.length : file.indexOf("?"));
				file = file.substring(file.lastIndexOf("/") + 1, file.length);
 
				if (file === 'Search.htm') 
				{
					var newPath = document.location.pathname + document.location.search + document.location.hash;
					newPath = newPath.replace(/#/, '?');
					newPath = newPath.replace(/search\-/, 'q=');
					ga('set', 'page', newPath);
				
					function locationHashChanged()
					{
						newPath = document.location.pathname + document.location.search + document.location.hash;
						newPath = newPath.replace(/#/, '?');
						newPath = newPath.replace(/search\-/, 'q=');
						ga('set', 'page', newPath);
						ga('send', 'pageview');
					}
				
					if(window.HashChangeEvent)
					{
						window.onhashchange = locationHashChanged;
					}
				}
				ga('send', 'pageview');
			/* ]]> */</script>
                                    </MadCap:conditionalText>
                                    <div class="nocontent">
                                        <div class="MCBreadcrumbsBox_0 breadcrumbs" role="navigation" aria-label="Breadcrumbs" data-mc-breadcrumbs-divider=" &gt; " data-mc-breadcrumbs-count="3" data-mc-toc="True"><span class="MCBreadcrumbsPrefix">You are here: </span>
                                        </div>
                                    </div>
                                    <p>&#160;</p>
                                    <div role="main" id="mc-main-content">
                                        <h1><a name="aanchor2244"></a>
                                            <MadCap:concept term="Retail" />How to:&#160;Run SQL Store Procedures</h1>
                                        <p class="shortcut"><a href="#LS" class="MCXref xref">LS One Site Manager</a>
                                        </p>
                                        <p class="shortcut"><a href="#CSCentral" class="MCXref xref">LS&#160;Central and LS Nav</a>
                                        </p>
                                        <p>The Data Director can execute Store Procedures, both the once that return value and those that do not.</p>
                                        <h2><a name="LS"></a>LS One Site Manager</h2>
                                        <p>With LS One Site Manager Demo data comes a Scheduler Job that runs a few Store Procedures subjobs. You can find a sample in the Subjob setup, look up Subjobs that start with the name <i>p-spXXXXX</i>. These jobs are Action jobs, and they will look for actions with an Object Name starting with the Store Procedure name that is set in the subjob. The jobs will execute the Parameter value as is when the Store Procedure is called. The same subjob can call different Store Procedures as long as they all start with the name specified in the subjob setup.</p>
                                        <h3>Sample of LS One Site Manager subjob</h3>
                                        <p>
                                            <img src="../../../Resources/Images/LS Data Director QuickGuides/SQL Store Procedures/Running SQL Store Procedures_450x317.png" class="images" style="width: 450;height: 317;" />
                                        </p>
                                        <h3>Sample of a record in the REPLICATIONACTIONS table</h3>
                                        <div class="codeSnippet"><a class="codeSnippetCopyButton" role="button" href="#">Copy</a>
                                            <div class="codeSnippetBody" data-mc-continue="False" data-mc-line-number-start="1" data-mc-use-line-numbers="False"><pre><code>ActionID&#160;&#160;&#160;&#160;Action&#160;&#160;&#160;&#160;ObjectName&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;AuditContext&#160;&#160;&#160;&#160;<br />5&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;4&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;spSECURITY_SetLocalProfileHash_1_0&#160;&#160;&#160;&#160;5BD7C5DA-F27F-4F72-9B2F-BF1E9FAF6336<br /><br />Parameters&#160;&#160;&#160;&#160;<br />@Login=N'admin',@DATAAREAID=N'LSR',@LocalProfileHash=N'8914CB6CD60957EB0E35395725F07810'&#160;&#160;&#160;&#160;<br /><br />DateCreated&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;DATAAREAID<br />2013-11-27 20:40:54.200&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;LSR</code></pre>
                                            </div>
                                        </div>
                                        <h2><a name="CSCentral"></a><span class="GeneralLSCentral_Mini">LS&#160;Central</span> and LS Nav</h2>
                                        <p>In current LS Nav versions, there is no direct support to run Store Procedure jobs within the LS Nav Scheduler. This can be done by calling the jobs from a code. </p>
                                        <p>The sample below calls a Store Procedure named <i>sp_test1 </i>with parameter 1. The return values are three fields that can be pulled the same way as if it was a reply from table query. If the Store procedure does not return any value, you can skip the "HasAnswer" part.</p>
                                        <div class="codeSnippet"><a class="codeSnippetCopyButton" role="button" href="#">Copy</a>
                                            <div class="codeSnippetCaption">LS Nav Codeunit Sample</div>
                                            <div class="codeSnippetBody" data-mc-continue="False" data-mc-line-number-start="1" data-mc-use-line-numbers="False"><pre><code>VAR<br />DataDir : Automation 'TransAutomClient'.TransAutomClient";<br />&#160;<br />// Create Interactive Connection to DDSRV Host with SQL Database Connection string<br />DataDir.CreateConnection('DDSRV','server=ddsrv;nt=tcp;dbname=nav;user=super;|ms|none',<br />TRUE);<br />&#160;<br />// Set Job to be Procedure job<br />DataDir.SetRequestType(5);&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// Procedure<br />DataDir.SetResultType(1);&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// List<br />DataDir.SetProcedure('sp_test1', '1');<br />&#160;<br />// Send job to DD<br />IF NOT DataDir.Send() THEN<br />&#160;&#160;EXIT;<br />&#160;<br />// If Store procedure does not returns value, this part can be skipped<br />// CreateConnection call does not need to be interactive if there is no return value<br />IF NOT DataDir.HasAnswer() THEN<br />&#160;&#160;EXIT;<br />&#160;<br />WHILE DataDir.NextValueList() DO BEGIN<br />&#160;&#160;IntVal := DataDir.GetInt(0);<br />&#160;&#160;IntVal := DataDir.GetInt(1);<br />&#160;&#160;StrVal := DataDir.GetString(2);<br />END;<br />&#160;<br />// Done reading result, disconnect from DD<br />DataDir.Disconnect();</code></pre>
                                            </div>
                                        </div>
                                        <p>&#160;</p>
                                        <p>&#160;</p>
                                    </div>
                                    <div id="footer" class="ls-nav-footer">
                                        <hr width="100%" size="0" align="center" />
                                        <p>© <span class="VariablesCurrentYear">2021</span> LS Retail ehf. All rights reserved.  </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div><a data-close="true"></a>
                </div>
            </div>
        </div>
    </body>
</html>